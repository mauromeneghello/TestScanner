var Save={init:function(e,t,n,r){this.saveForm=e;this.titleSelector=t;this.abstractSelector=n;this.authForm=r},authenticate:function(e,t,n){var r=this;$.ajax({url:t,type:"POST",data:n,beforeSend:r._setCSRF,statusCode:{200:function(t){console.log(r.authForm);$(r.authForm).modal("hide");$(r.saveForm).modal("show");$(e).attr("href",r.saveForm)},400:function(e){new PNotify({title:"Error",text:"Bad credentials",type:"error"})}}})},save:function(e,t){var n=$(this.titleSelector).val().trim();if(n){$(e).off();$(this.saveSelector).modal("hide");postData=this._retrieveFormElements();postData.data=JSON.stringify(t);$.ajax({url:"/analytics/new/data/",type:"POST",data:JSON.stringify(postData),dataType:"json",beforeSend:this._setCSRF,success:function(e){window.location.replace("/analytics/"+e+"/view/")},statusCode:{401:function(e){new PNotify({title:"You have to be logged in to save an Analysis.",type:"error"})}}})}else{$(this.titleSelector).closest(".control-group").addClass("error")}},update:function(e,t){var n={};n.data=JSON.stringify(t);$.ajax({url:"/analytics/"+e+"/data/",type:"PUT",data:JSON.stringify(n),dataType:"json",beforeSend:this._setCSRF,statusCode:{200:function(e){new PNotify({title:"Analysis saved !",type:"success"})},401:function(e){new PNotify({title:"You have to be logged in to update an Analysis.",type:"error"})}}})},_retrieveFormElements:function(){var e={};e.title=$(this.titleSelector).val();e.abstract=$(this.abstractSelector).val();return e},_setCSRF:function(e,t){e.setRequestHeader("X-XSRFToken",Save._getCookie("csrftoken"))},_getCookie:function(e){var t=null;if(document.cookie&&document.cookie!=""){var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=jQuery.trim(n[r]);if(i.substring(0,e.length+1)==e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}}
